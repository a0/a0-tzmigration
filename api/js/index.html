<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript npm package | A0 Time Zone Migration</title>
    <meta name="description" content="Utilities to help with migrations between timezone changes when they happen in the tzdb/zoneinfo/Olson database">
    
    
    <link rel="preload" href="/a0-tzmigration/assets/css/0.styles.0f296cea.css" as="style"><link rel="preload" href="/a0-tzmigration/assets/js/app.af78ef3d.js" as="script"><link rel="preload" href="/a0-tzmigration/assets/js/5.1b635d64.js" as="script"><link rel="prefetch" href="/a0-tzmigration/assets/js/3.30c5cee4.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/1.a9c3a52d.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/2.4ba2b300.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/4.8e459df1.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/6.f5651b9b.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/7.ba473195.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/8.49bc5d74.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/9.86deb54e.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/10.1311d7aa.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/11.5306a43e.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/12.525759c0.js">
    <link rel="stylesheet" href="/a0-tzmigration/assets/css/0.styles.0f296cea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/a0-tzmigration/" class="home-link router-link-active"><!----><span class="site-name">
      A0 Time Zone Migration
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/a0-tzmigration/demo/" class="nav-link">Demo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/ruby/" class="nav-link">Ruby gem</a></li><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/js/" class="nav-link router-link-exact-active router-link-active">JS npm</a></li></ul></div></div><div class="nav-item"><a href="/a0-tzmigration/data/" class="nav-link">About the Repo</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/a0-tzmigration/demo/" class="nav-link">Demo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/ruby/" class="nav-link">Ruby gem</a></li><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/js/" class="nav-link router-link-exact-active router-link-active">JS npm</a></li></ul></div></div><div class="nav-item"><a href="/a0-tzmigration/data/" class="nav-link">About the Repo</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>JavaScript npm package</span><!----></p><ul class="sidebar-group-items"><li><a href="/a0-tzmigration/api/js/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/js/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/js/#basic-usage" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/js/#other-use-cases" class="sidebar-link">Other use cases</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/js/#how-it-works" class="sidebar-link">How it works</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="javascript-npm-package"><a href="#javascript-npm-package" aria-hidden="true" class="header-anchor">#</a> JavaScript npm package</h1><h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2><p>The <a href="https://npmjs.com/package/a0-tzmigration-js" target="_blank" rel="noopener noreferrer">a0-tzmigration-js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> npm package helps you automate the correction of inconsistencies when a new tzdb is released, given the following:</p><ul><li>your system stores all dates as unix timestamps, ie: seconds since the epoch ignoring leap seconds. Many current software works this way.</li><li>your system/users choose a local representation that transform the above date to their local time. You should use an official tzdb timezone, like <code>America/Santiago</code>, or some mechanism to get that, UTC offsets like -04:00 are not enough.</li><li>your system stores somewhere what version of the tzdb is currently being used, like <code>2018e</code>.</li></ul><h3 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h3><p>Using npm:</p><div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> -i a0-tzmigration-js
</code></pre></div><h3 id="basic-usage"><a href="#basic-usage" aria-hidden="true" class="header-anchor">#</a> Basic Usage</h3><p>Suppose your system is using tzdb version <code>2014j</code>, and a new version <code>2015a</code> is released. Once the sysadmin install the new version, users tell you there are inconsistencies.</p><p>Using this package, you can query what changed for <code>America/Santiago</code> between versions <code>2014j</code> and <code>2015a</code>:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TZVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'a0-tzmigration-js'</span>

<span class="token keyword">let</span> version_a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TZVersion</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2014j'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> version_b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TZVersion</span><span class="token punctuation">(</span><span class="token string">'America/Punta_Arenas'</span><span class="token punctuation">,</span> <span class="token string">'2015a'</span><span class="token punctuation">)</span>

version_a<span class="token punctuation">.</span><span class="token function">changes</span><span class="token punctuation">(</span>version_b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changes<span class="token punctuation">)</span>
<span class="token comment">/* =&gt;
[ { ini_str: &quot;2015-04-26 03:00:00 UTC&quot;, fin_str: &quot;2015-09-06 04:00:00 UTC&quot;, off_str: &quot;+01:00:00&quot;, ini: 1430017200, fin: 1441512000, off: 3600},
  { ini_str: &quot;2016-04-24 03:00:00 UTC&quot;, fin_str: &quot;2016-09-04 04:00:00 UTC&quot;, off_str: &quot;+01:00:00&quot;, ini: 1461466800, fin: 1472961600, off: 3600},
  … (ommited) …
  { ini_str: &quot;2063-04-29 03:00:00 UTC&quot;, fin_str: &quot;2063-09-02 04:00:00 UTC&quot;, off_str: &quot;+01:00:00&quot;, ini: 2945041200, fin: 2955931200, off: 3600},
  { ini_str: &quot;2064-04-27 03:00:00 UTC&quot;, fin_str: &quot;∞&quot;, off_str: &quot;+01:00:00&quot;, ini: 2976490800, fin: Infinity, off: 3600} ]
 */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Please note that changes() returns a Promise.</p><p>The resulting changes is an array of objects, where:</p><ul><li><code>ini</code>, <code>fin</code> are unix timestamps or <code>-Infinity</code>, <code>Infinity</code>.</li><li><code>off</code> is seconds to add, or substract if negative.</li><li><code>ini_fin</code>, <code>fin_str</code>, <code>off_str</code> are strings with the same meaning.</li></ul><p>The same changes in a table:</p><table><thead><tr><th>ini_str</th><th>fin_str</th><th>off_str</th><th>ini</th><th>fin</th><th>off</th></tr></thead><tbody><tr><td>2015-04-26 03:00:00 UTC</td><td>2015-09-06 04:00:00 UTC</td><td>+01:00:00</td><td>1430017200</td><td>1441512000</td><td>3600</td></tr><tr><td>2016-04-24 03:00:00 UTC</td><td>2016-09-04 04:00:00 UTC</td><td>+01:00:00</td><td>1461466800</td><td>1472961600</td><td>3600</td></tr><tr><td>… (ommited) …</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>2063-04-29 03:00:00 UTC</td><td>2063-09-02 04:00:00 UTC</td><td>+01:00:00</td><td>2945041200</td><td>2955931200</td><td>3600</td></tr><tr><td>2064-04-27 03:00:00 UTC</td><td>∞</td><td>+01:00:00</td><td>2976490800</td><td>Infinity</td><td>3600</td></tr></tbody></table><p>For each change, the rule to search affected dates in your system should be the following: <br>
if <strong>ini</strong> ≤ <em><strong>date</strong></em> &lt; <strong>fin</strong> then <strong>date</strong> += <strong>off</strong><br>
English: for dates between <strong>ini</strong> (included) and <strong>fin</strong> (excluded), add <strong>off</strong> to them.</p><p>Using our example, here are some changes that may be applied:</p><ul><li>For dates between 2015-04-26 03:00:00 UTC and 2015-09-06 04:00:00 UTC, add 1 hour.</li><li>For dates between 2064-04-27 03:00:00 UTC and ∞, add 1 hour.</li></ul><p><strong>You should always make sure you are comparing unix timestamps, or quering your system using UTC</strong>. Never convert the above timestamps to localtime.</p><p>To convert a <code>Date</code> javascript object to unix timestamp, you can do the following:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
timestamp <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; 1528057688</span>
</code></pre></div><p>To convert a unix timestamp to a <code>Date</code> javascript object, do the following:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>timestamp <span class="token operator">=</span> <span class="token number">1472961600</span><span class="token punctuation">;</span>

date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timestamp <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// note this is localtime</span>
<span class="token comment">// =&gt; Sun Sep 04 2016 01:00:00 GMT-0300 (Chile Summer Time)</span>
</code></pre></div><p>I suggest you use a library to get UTC support, like <a href="https://momentjs.com" target="_blank" rel="noopener noreferrer">Moment.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><h3 id="other-use-cases"><a href="#other-use-cases" aria-hidden="true" class="header-anchor">#</a> Other use cases</h3><p>You can calculate changes between any <em>(timezone, version)</em>, not only consecutive transitions of a timezone. This is useful if the tzdb has not been updated regularly in your system, say you need to check the changes for <em>(America/Santiago, 2015a)</em> → <em>(America/Santiago, 2017a)</em>.</p><p>Maybe your users need to change their timezone. This happened in my country in 2017: a new timezone America/Punta_Arenas was created for the south region only. So, we needed to check the changes for <em>(America/Santiago, 2015a)</em> → <em>(America/Punta_Arenas, 2017a)</em>.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TZVersion <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'a0-tzmigration-js'</span>

<span class="token keyword">let</span> version_a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TZVersion</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2015a'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> version_b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TZVersion</span><span class="token punctuation">(</span><span class="token string">'America/Punta_Arenas'</span><span class="token punctuation">,</span> <span class="token string">'2017a'</span><span class="token punctuation">)</span>

version_a<span class="token punctuation">.</span><span class="token function">changes</span><span class="token punctuation">(</span>version_b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>changes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changes<span class="token punctuation">)</span>
<span class="token comment">/* =&gt;
  [{ ini_str: &quot;-∞&quot;, fin_str: &quot;1890-01-01 04:43:40 UTC&quot;, off_str: &quot;-00:00:54&quot;, ini: -Infinity, fin: -2524504580, off: -54 },
   { ini_str: &quot;1910-01-01 04:42:46 UTC&quot;, fin_str: &quot;1910-01-10 04:42:46 UTC&quot;, off_str: &quot;+00:17:14&quot;, ini: -1893439034, fin: -1892661434, off: 1034 },
   { ini_str: &quot;1918-09-01 04:42:46 UTC&quot;, fin_str: &quot;1918-09-10 04:42:46 UTC&quot;, off_str: &quot;-00:42:46&quot;, ini: -1619983034, fin: -1619205434, off: -2566 },
   { ini_str: &quot;1946-09-01 03:00:00 UTC&quot;, fin_str: &quot;1947-04-01 04:00:00 UTC&quot;, off_str: &quot;+01:00:00&quot;, ini: -736376400, fin: -718056000, off: 3600 },
   { ini_str: &quot;1947-05-22 04:00:00 UTC&quot;, fin_str: &quot;1947-05-22 05:00:00 UTC&quot;, off_str: &quot;+01:00:00&quot;, ini: -713649600, fin: -713646000, off: 3600 },
   { ini_str: &quot;1988-10-02 04:00:00 UTC&quot;, fin_str: &quot;1988-10-09 04:00:00 UTC&quot;, off_str: &quot;-01:00:00&quot;, ini: 591768000, fin: 592372800, off: -3600 },
   { ini_str: &quot;1990-03-11 03:00:00 UTC&quot;, fin_str: &quot;1990-03-18 03:00:00 UTC&quot;, off_str: &quot;-01:00:00&quot;, ini: 637124400, fin: 637729200, off: -3600 },
   { ini_str: &quot;2016-05-15 03:00:00 UTC&quot;, fin_str: &quot;2016-08-14 04:00:00 UTC&quot;, off_str: &quot;-01:00:00&quot;, ini: 1463281200, fin: 1471147200, off: -3600 }]
 */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>If you want to create an UI, you can query the index of currently known timezones:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// get current known timezones in the repository</span>
TZVersion<span class="token punctuation">.</span><span class="token function">timezones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>transitions <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>timezones<span class="token punctuation">)</span>
<span class="token comment">/* =&gt;
  { &quot;Africa/Abidjan&quot;:
    { &quot;versions&quot;: [ &quot;2013c&quot;, &quot;2013d&quot;, &quot;2013e&quot;, &quot;2013f&quot;, &quot;2013g&quot;, …
 */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>You can also query the index of currently known versions:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// get current known versions in the repository</span>
TZVersion<span class="token punctuation">.</span><span class="token function">versions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>versions <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>versions<span class="token punctuation">)</span>
<span class="token comment">/* =&gt;
  { &quot;2013c&quot;:
    { &quot;released_at&quot;: &quot;2013-04-19 16:17:40 -0700&quot;,
      &quot;timezones&quot;: [ &quot;Africa/Abidjan&quot;, &quot;Africa/Accra&quot;, &quot;Africa/Addis_Ababa&quot;, &quot;Africa/Algiers&quot;, &quot;Africa/Asmara&quot;, …
 */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="how-it-works"><a href="#how-it-works" aria-hidden="true" class="header-anchor">#</a> How it works</h3><p>When you create a new TZVersion instance, it will download on demand the corresponding timezone file from our <a href="https://a0.github.io/a0-tzmigration-ruby/data/" target="_blank" rel="noopener noreferrer">tzdb version Repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which is documented here: <a href="/a0-tzmigration/data/">About the Repo</a>.</p><p>Your browser/system needs to have access to the internet in order to download that file. The file is cached once per instance.</p><p>When you call <code>version_a.changes(version_b)</code>, it will compare the transitions of both versions and returns an array of changes.</p><p>The indexes are never cached in <code>TZVersion.versions()</code> or <code>TZVersion.timezones()</code>, but you may have a proxy, and surely your browser does caching.</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/a0/a0-tzmigration/edit/master/docs/api/js/README.md" target="_blank" rel="noopener noreferrer">Help us improve this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="last-updated"><span class="prefix">updated: </span><span class="time">6/3/2018, 7:40:57 PM</span></div></div><!----></div></div></div>
    <script src="/a0-tzmigration/assets/js/5.1b635d64.js" defer></script><script src="/a0-tzmigration/assets/js/app.af78ef3d.js" defer></script>
  </body>
</html>
