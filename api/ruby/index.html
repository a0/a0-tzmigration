<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby gem | A0 Time Zone Migration</title>
    <meta name="description" content="Utilities to help with migrations between timezone changes when they happen in the tzdb/zoneinfo/Olson database">
    
    
    <link rel="preload" href="/a0-tzmigration/assets/css/0.styles.0f296cea.css" as="style"><link rel="preload" href="/a0-tzmigration/assets/js/app.af78ef3d.js" as="script"><link rel="preload" href="/a0-tzmigration/assets/js/4.8e459df1.js" as="script"><link rel="prefetch" href="/a0-tzmigration/assets/js/3.30c5cee4.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/1.a9c3a52d.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/2.4ba2b300.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/5.1b635d64.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/6.f5651b9b.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/7.ba473195.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/8.49bc5d74.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/9.86deb54e.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/10.1311d7aa.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/11.5306a43e.js"><link rel="prefetch" href="/a0-tzmigration/assets/js/12.525759c0.js">
    <link rel="stylesheet" href="/a0-tzmigration/assets/css/0.styles.0f296cea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/a0-tzmigration/" class="home-link router-link-active"><!----><span class="site-name">
      A0 Time Zone Migration
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/a0-tzmigration/demo/" class="nav-link">Demo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/ruby/" class="nav-link router-link-exact-active router-link-active">Ruby gem</a></li><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/js/" class="nav-link">JS npm</a></li></ul></div></div><div class="nav-item"><a href="/a0-tzmigration/data/" class="nav-link">About the Repo</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/a0-tzmigration/demo/" class="nav-link">Demo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">API</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/ruby/" class="nav-link router-link-exact-active router-link-active">Ruby gem</a></li><li class="dropdown-item"><!----><a href="/a0-tzmigration/api/js/" class="nav-link">JS npm</a></li></ul></div></div><div class="nav-item"><a href="/a0-tzmigration/data/" class="nav-link">About the Repo</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Ruby gem</span><!----></p><ul class="sidebar-group-items"><li><a href="/a0-tzmigration/api/ruby/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#basic-usage" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#other-use-cases" class="sidebar-link">Other use cases</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#how-it-works" class="sidebar-link">How it works</a></li></ul></li><li><a href="/a0-tzmigration/api/ruby/#configuration" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#base-url" class="sidebar-link">base_url</a></li></ul></li><li><a href="/a0-tzmigration/api/ruby/#tzversion-instance-methods" class="sidebar-link">TZVersion instance methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#initialize-name-version" class="sidebar-link">initialize(name, version)</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#data" class="sidebar-link">data</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#version-data" class="sidebar-link">version_data</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#released-at" class="sidebar-link">released_at</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#transitions" class="sidebar-link">transitions</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#transition-ranges" class="sidebar-link">transition_ranges</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#timestamps" class="sidebar-link">timestamps</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#changes" class="sidebar-link">changes</a></li></ul></li><li><a href="/a0-tzmigration/api/ruby/#tzversion-static-methods" class="sidebar-link">TZVersion static methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#versions" class="sidebar-link">versions</a></li><li class="sidebar-sub-header"><a href="/a0-tzmigration/api/ruby/#timezones" class="sidebar-link">timezones</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="ruby-gem"><a href="#ruby-gem" aria-hidden="true" class="header-anchor">#</a> Ruby gem</h1><h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2><p>The <a href="https://rubygems.org/gems/a0-tzmigration-ruby" target="_blank" rel="noopener noreferrer">a0-tzmigration-ruby<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> gem helps you automate the correction of inconsistencies when a new tzdb is released, given the following:</p><ul><li>your system stores all dates as unix timestamps, ie: seconds since the epoch ignoring leap seconds. Many current software works this way.</li><li>your system/users choose a local representation that transform the above date to their local time. You should use an official tzdb timezone, like <code>America/Santiago</code>, or some mechanism to get that, UTC offsets like -04:00 are not enough.</li><li>your system stores somewhere what version of the tzdb is currently being used, like <code>2018e</code>.</li></ul><h3 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h3><p>Add this line to your application's Gemfile:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>gem <span class="token string">'a0-tzmigration-ruby'</span>
</code></pre></div><p>And then execute:</p><div class="language-bash extra-class"><pre class="language-bash"><code>$ bundle
</code></pre></div><p>Or install it yourself as:</p><div class="language-bash extra-class"><pre class="language-bash"><code>$ gem <span class="token function">install</span> a0-tzmigration-ruby
</code></pre></div><h3 id="basic-usage"><a href="#basic-usage" aria-hidden="true" class="header-anchor">#</a> Basic Usage</h3><p>Suppose your system is using tzdb version <code>2014j</code>, and a new version <code>2015a</code> is released. Once the sysadmin install the new version, users tell you there are inconsistencies.</p><p>Using this gem, you can query what changed for <code>America/Santiago</code> between versions <code>2014j</code> and <code>2015a</code>:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">'a0-tzmigration-ruby'</span>

version_a <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2014j'</span><span class="token punctuation">)</span>
version_b <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2015a'</span><span class="token punctuation">)</span>

version_a<span class="token punctuation">.</span><span class="token function">changes</span><span class="token punctuation">(</span>version_b<span class="token punctuation">)</span>
<span class="token comment"># =&gt;</span>
<span class="token comment"># [{:ini_str=&gt;&quot;2015-04-26 03:00:00 UTC&quot;, :fin_str=&gt;&quot;2015-09-06 04:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;1430017200, :fin=&gt;1441512000, :off=&gt;3600},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2016-04-24 03:00:00 UTC&quot;, :fin_str=&gt;&quot;2016-09-04 04:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;1461466800, :fin=&gt;1472961600, :off=&gt;3600},</span>
<span class="token comment">#  … (ommited) …</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2063-04-29 03:00:00 UTC&quot;, :fin_str=&gt;&quot;2063-09-02 04:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;2945041200, :fin=&gt;2955931200, :off=&gt;3600},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2064-04-27 03:00:00 UTC&quot;, :fin_str=&gt;&quot;∞&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;2976490800, :fin=&gt;Infinity, :off=&gt;3600} ]</span>
</code></pre></div><p>The resulting changes is an array of objects, where:</p><ul><li><code>ini</code>, <code>fin</code> are unix timestamps or <code>-Float::INFINITY</code>, <code>Float::INFINITY</code>.</li><li><code>off</code> is seconds to add, or substract if negative.</li><li><code>ini_fin</code>, <code>fin_str</code> are the same ini, fin as UTC strings date, or <code>-∞</code>, <code>∞</code>.</li><li><code>off_str</code> is the same off as string.</li></ul><p>The same changes in a table:</p><table><thead><tr><th>ini_str</th><th>fin_str</th><th>off_str</th><th>ini</th><th>fin</th><th>off</th></tr></thead><tbody><tr><td>2015-04-26 03:00:00 UTC</td><td>2015-09-06 04:00:00 UTC</td><td>+01:00:00</td><td>1430017200</td><td>1441512000</td><td>3600</td></tr><tr><td>2016-04-24 03:00:00 UTC</td><td>2016-09-04 04:00:00 UTC</td><td>+01:00:00</td><td>1461466800</td><td>1472961600</td><td>3600</td></tr><tr><td>… (ommited) …</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>2063-04-29 03:00:00 UTC</td><td>2063-09-02 04:00:00 UTC</td><td>+01:00:00</td><td>2945041200</td><td>2955931200</td><td>3600</td></tr><tr><td>2064-04-27 03:00:00 UTC</td><td>∞</td><td>+01:00:00</td><td>2976490800</td><td>Infinity</td><td>3600</td></tr></tbody></table><p>For each change, the rule to search affected dates in your system should be the following: <br>
if <strong>ini</strong> ≤ <em><strong>date</strong></em> &lt; <strong>fin</strong> then <strong>date</strong> += <strong>off</strong><br>
English: for dates between <strong>ini</strong> (included) and <strong>fin</strong> (excluded), add <strong>off</strong> to them.</p><p>Using our example, here are some changes that may be applied:</p><ul><li>For dates between 2015-04-26 03:00:00 UTC and 2015-09-06 04:00:00 UTC, add 1 hour.</li><li>For dates between 2064-04-27 03:00:00 UTC and ∞, add 1 hour.</li></ul><p><strong>You should always make sure you are comparing unix timestamps, or quering your system using UTC</strong>. Never convert the above timestamps to localtime.</p><p>To convert a <code>Time</code> ruby object to unix timestamp, you can do the following:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>date <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span><span class="token keyword">new</span>
<span class="token class-name">timestamp</span> <span class="token operator">=</span> date<span class="token punctuation">.</span>to_i
<span class="token comment"># =&gt; 1528057688</span>
</code></pre></div><p>To convert a unix timestamp to a <code>Time</code> ruby object, do the following:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>timestamp <span class="token operator">=</span> <span class="token number">1472961600</span>

date <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span>       <span class="token comment"># note this is localtime</span>
<span class="token comment"># =&gt; 2016-09-04 01:00:00 -0300</span>

date <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">.</span>utc   <span class="token comment"># prefer this, UTC time</span>
<span class="token comment"># =&gt; 2016-09-04 04:00:00 UTC</span>
</code></pre></div><h3 id="other-use-cases"><a href="#other-use-cases" aria-hidden="true" class="header-anchor">#</a> Other use cases</h3><p>You can calculate changes between any <em>(timezone, version)</em>, not only consecutive transitions of a timezone. This is useful if the tzdb has not been updated regularly in your system, say you need to check the changes for <em>(America/Santiago, 2015a)</em> → <em>(America/Santiago, 2017a)</em>.</p><p>Maybe your users need to change their timezone. This happened in my country in 2017: a new timezone America/Punta_Arenas was created for the south region only. So, we needed to check the changes for <em>(America/Santiago, 2015a)</em> → <em>(America/Punta_Arenas, 2017a)</em>.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">'a0-tzmigration-ruby'</span>

version_a <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2015a'</span><span class="token punctuation">)</span>
version_b <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Punta_Arenas'</span><span class="token punctuation">,</span> <span class="token string">'2017a'</span><span class="token punctuation">)</span>

version_a<span class="token punctuation">.</span><span class="token function">changes</span><span class="token punctuation">(</span>version_b<span class="token punctuation">)</span>
<span class="token comment"># =&gt; [{:ini_str=&gt;&quot;-∞&quot;, :fin_str=&gt;&quot;1890-01-01 04:43:40 UTC&quot;, :off_str=&gt;&quot;-00:00:54&quot;, :ini=&gt;-Infinity, :fin=&gt;-2524504580, :off=&gt;-54},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1910-01-01 04:42:46 UTC&quot;, :fin_str=&gt;&quot;1910-01-10 04:42:46 UTC&quot;, :off_str=&gt;&quot;+00:17:14&quot;, :ini=&gt;-1893439034, :fin=&gt;-1892661434, :off=&gt;1034},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1918-09-01 04:42:46 UTC&quot;, :fin_str=&gt;&quot;1918-09-10 04:42:46 UTC&quot;, :off_str=&gt;&quot;-00:42:46&quot;, :ini=&gt;-1619983034, :fin=&gt;-1619205434, :off=&gt;-2566},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1946-09-01 03:00:00 UTC&quot;, :fin_str=&gt;&quot;1947-04-01 04:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;-736376400, :fin=&gt;-718056000, :off=&gt;3600},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1947-05-22 04:00:00 UTC&quot;, :fin_str=&gt;&quot;1947-05-22 05:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;-713649600, :fin=&gt;-713646000, :off=&gt;3600},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1988-10-02 04:00:00 UTC&quot;, :fin_str=&gt;&quot;1988-10-09 04:00:00 UTC&quot;, :off_str=&gt;&quot;-01:00:00&quot;, :ini=&gt;591768000, :fin=&gt;592372800, :off=&gt;-3600},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;1990-03-11 03:00:00 UTC&quot;, :fin_str=&gt;&quot;1990-03-18 03:00:00 UTC&quot;, :off_str=&gt;&quot;-01:00:00&quot;, :ini=&gt;637124400, :fin=&gt;637729200, :off=&gt;-3600},</span>
<span class="token comment">#     {:ini_str=&gt;&quot;2016-05-15 03:00:00 UTC&quot;, :fin_str=&gt;&quot;2016-08-14 04:00:00 UTC&quot;, :off_str=&gt;&quot;-01:00:00&quot;, :ini=&gt;1463281200, :fin=&gt;1471147200, :off=&gt;-3600}]</span>
</code></pre></div><p>If you want to create an UI, you can query the index of currently known timezones:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># get current known timezones in the repository</span>
<span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span>timezones
<span class="token comment"># =&gt; { &quot;Africa/Abidjan&quot; =&gt;</span>
<span class="token comment">#      { &quot;versions&quot; =&gt; [ &quot;2013c&quot;, &quot;2013d&quot;, &quot;2013e&quot;, &quot;2013f&quot;, &quot;2013g&quot;, …</span>
</code></pre></div><p>You can also query the index of currently known versions:</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># get current known versions in the repository</span>
<span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span>versions
<span class="token comment"># =&gt; { &quot;2013c&quot; =&gt;</span>
<span class="token comment">#      { &quot;released_at&quot; =&gt; &quot;2013-04-19 16:17:40 -0700&quot;,</span>
<span class="token comment">#        &quot;timezones&quot; =&gt; [ &quot;Africa/Abidjan&quot;, &quot;Africa/Accra&quot;, &quot;Africa/Addis_Ababa&quot;, &quot;Africa/Algiers&quot;, &quot;Africa/Asmara&quot;, …</span>
</code></pre></div><h3 id="how-it-works"><a href="#how-it-works" aria-hidden="true" class="header-anchor">#</a> How it works</h3><p>When you create a new TZVersion instance, it will download on demand the corresponding timezone file from our <a href="https://a0.github.io/a0-tzmigration-ruby/data/" target="_blank" rel="noopener noreferrer">tzdb version Repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which is documented here: <a href="/a0-tzmigration/data/">About the Repo</a>.</p><p>Your system needs to have access to the internet in order to download that file. The file is cached once per instance.</p><p>When you call <code>version_a.changes(version_b)</code>, it will compare the transitions of both versions and returns an array of changes.</p><p>The indexes are never cached in <code>TZVersion.timezones</code> or <code>TZVersion.versions</code>, but you may have a proxy.</p><h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2><h3 id="base-url"><a href="#base-url" aria-hidden="true" class="header-anchor">#</a> base_url</h3><ul><li>default: <code>'https://a0.github.io/a0-tzmigration-ruby/data/'</code></li></ul><p>The URL from where files of the tzdb version repository will be downloaded. It must end with a <code>/</code>.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">.</span>configure <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>base_url <span class="token operator">=</span> <span class="token string">'https://127.0.0.1/my/repo/'</span>
<span class="token keyword">end</span>

version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>data <span class="token comment"># will fetch 'https://127.0.0.1/my/repo/timezones/America/Santiago.json'</span>
</code></pre></div><h2 id="tzversion-instance-methods"><a href="#tzversion-instance-methods" aria-hidden="true" class="header-anchor">#</a> TZVersion instance methods</h2><h3 id="initialize-name-version"><a href="#initialize-name-version" aria-hidden="true" class="header-anchor">#</a> initialize(name, version)</h3><ul><li>parameters:
<ul><li><strong>name</strong>: the name of the timezone, like <code>'America/Santiago'</code></li><li><strong>version</strong>: the version of the tzdb release, like <code>'2018e'</code></li></ul></li></ul><p>Creates a new TZVersion, for the given name and version.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="data"><a href="#data" aria-hidden="true" class="header-anchor">#</a> data</h3><ul><li>returns: <code>Hash</code></li><li>cached: yes</li></ul><p>Returns and caches the contents of the <a href="/a0-tzmigration/data/#the-timezones-json-structure">Repository JSON file</a>, as read from the internet.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>data
<span class="token comment"># =&gt; {&quot;name&quot;=&gt;&quot;America/Santiago&quot;, &quot;versions&quot;=&gt;{&quot;2013c&quot;=&gt;{&quot;tag&quot;=&gt;&quot;v1.2013.3&quot;, &quot;released_at&quot;=&gt;&quot;2013-04-19 16:17:40 -0700&quot;, &quot;transitions&quot;=&gt;[{&quot;utc_offset&quot;=&gt;-16966, &quot;utc_prev_offset&quot;=&gt;-16966, &quot;utc_timestamp&quot;=&gt;-2524504634, &quot;utc_time&quot;=&gt;&quot;1890-01-01T04:42:46+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;1890-01-01 00:00:00 LMT&quot;, &quot;local_fin_str&quot;=&gt;&quot;1890-01-01 00:00:00 SMT&quot;}, …</span>
</code></pre></div><h3 id="version-data"><a href="#version-data" aria-hidden="true" class="header-anchor">#</a> version_data</h3><ul><li>returns: <code>Hash</code></li><li>cached: yes</li><li>throws: <code>RuntimeError</code> if the version was not found in the data.</li></ul><p>Returns and caches the corresponding value to the versions dictionary from the current data.</p><p>If this version is an alias to another timezone, that timezone is fetched and the version_data of that timezone is returned.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>version_data
<span class="token comment"># =&gt; {&quot;tag&quot;=&gt;&quot;v1.2018.5&quot;, &quot;released_at&quot;=&gt;&quot;2018-05-01 23:42:51 -0700&quot;, &quot;transitions&quot;=&gt;[{&quot;utc_offset&quot;=&gt;-16966, &quot;utc_prev_offset&quot;=&gt;-16966, &quot;utc_timestamp&quot;=&gt;-2524504634, &quot;utc_time&quot;=&gt;&quot;1890-01-01T04:42:46+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;1890-01-01 00:00:00 LMT&quot;, &quot;local_fin_str&quot;=&gt;&quot;1890-01-01 00:00:00 SMT&quot;}, {&quot;utc_offset&quot;=&gt;-18000, &quot;utc_prev_offset&quot;=&gt;-16966, &quot;utc_timestamp&quot;=&gt;-1892661434, &quot;utc_time&quot;=&gt;&quot;1910-01-10T04:42:46+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;1910-01-10 00:00:00 SMT&quot;, &quot;local_fin_str&quot;=&gt;&quot;1910-01-09 23:42:46 -05&quot;}, …</span>
</code></pre></div><h3 id="released-at"><a href="#released-at" aria-hidden="true" class="header-anchor">#</a> released_at</h3><ul><li>returns: <code>String</code></li><li>cached: yes</li></ul><p>Returns and caches the corresponding released_at from the current version_data.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>released_at
<span class="token comment"># =&gt; 2018-05-01 23:42:51 -0700</span>
</code></pre></div><h3 id="transitions"><a href="#transitions" aria-hidden="true" class="header-anchor">#</a> transitions</h3><ul><li>returns: <code>Array</code></li><li>cached: yes</li></ul><p>Returns and caches the corresponding <a href="/a0-tzmigration/data/#transitions">transitions</a> from the current version_data.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>transitions
<span class="token comment"># =&gt; </span>
<span class="token comment"># [{&quot;utc_offset&quot;=&gt;-16966, &quot;utc_prev_offset&quot;=&gt;-16966, &quot;utc_timestamp&quot;=&gt;-2524504634, &quot;utc_time&quot;=&gt;&quot;1890-01-01T04:42:46+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;1890-01-01 00:00:00 LMT&quot;, &quot;local_fin_str&quot;=&gt;&quot;1890-01-01 00:00:00 SMT&quot;}</span>
<span class="token comment">#  {&quot;utc_offset&quot;=&gt;-18000, &quot;utc_prev_offset&quot;=&gt;-16966, &quot;utc_timestamp&quot;=&gt;-1892661434, &quot;utc_time&quot;=&gt;&quot;1910-01-10T04:42:46+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;1910-01-10 00:00:00 SMT&quot;, &quot;local_fin_str&quot;=&gt;&quot;1910-01-09 23:42:46 -05&quot;}</span>
<span class="token comment">#  …</span>
<span class="token comment">#  {&quot;utc_offset&quot;=&gt;-10800, &quot;utc_prev_offset&quot;=&gt;-14400, &quot;utc_timestamp&quot;=&gt;3080520000, &quot;utc_time&quot;=&gt;&quot;2067-08-14T04:00:00+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;2067-08-14 00:00:00 -04&quot;, &quot;local_fin_str&quot;=&gt;&quot;2067-08-14 01:00:00 -03&quot;}</span>
<span class="token comment">#  {&quot;utc_offset&quot;=&gt;-14400, &quot;utc_prev_offset&quot;=&gt;-10800, &quot;utc_timestamp&quot;=&gt;3104103600, &quot;utc_time&quot;=&gt;&quot;2068-05-13T03:00:00+00:00&quot;, &quot;local_ini_str&quot;=&gt;&quot;2068-05-13 00:00:00 -03&quot;, &quot;local_fin_str&quot;=&gt;&quot;2068-05-12 23:00:00 -04&quot;} ]</span>
</code></pre></div><p>The transitions are sorted.</p><h3 id="transition-ranges"><a href="#transition-ranges" aria-hidden="true" class="header-anchor">#</a> transition_ranges</h3><ul><li>returns: <code>Array</code></li><li>cached: yes</li></ul><p>Returns and caches a generated transition ranges from the current version_data.</p><p>A transition range represents a continuos time where this timezone has the same offset from UTC. Is an array of dictionaries with the following keys:</p><ul><li><code>ini</code> is the starting time (inclusive) as a unix timestamp or <code>-Float::INFINITY</code>.</li><li><code>fin</code> is the ending time (exclusive) as a unix timestamps or <code>Float::INFINITY</code>.</li><li><code>off</code> is the number of seconds offset from UTC.</li><li><code>ini_fin</code>, <code>fin_str</code> are the same ini, fin as UTC strings date, or <code>-∞</code>, <code>∞</code>.</li><li><code>off_str</code> is the same off as a string.</li></ul><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>transition_ranges
<span class="token comment"># =&gt; </span>
<span class="token comment"># [{:ini_str=&gt;&quot;-∞&quot;, :fin_str=&gt;&quot;1890-01-01 04:42:46 UTC&quot;, :off_str=&gt;&quot;-04:42:46&quot;, :ini=&gt;-Infinity, :fin=&gt;-2524504634, :off=&gt;-16966},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;1890-01-01 04:42:46 UTC&quot;, :fin_str=&gt;&quot;1910-01-10 04:42:46 UTC&quot;, :off_str=&gt;&quot;-04:42:46&quot;, :ini=&gt;-2524504634, :fin=&gt;-1892661434, :off=&gt;-16966},</span>
<span class="token comment">#  …</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2067-08-14 04:00:00 UTC&quot;, :fin_str=&gt;&quot;2068-05-13 03:00:00 UTC&quot;, :off_str=&gt;&quot;-03:00:00&quot;, :ini=&gt;3080520000, :fin=&gt;3104103600, :off=&gt;-10800},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2068-05-13 03:00:00 UTC&quot;, :fin_str=&gt;&quot;∞&quot;, :off_str=&gt;&quot;-04:00:00&quot;, :ini=&gt;3104103600, :fin=&gt;Infinity, :off=&gt;-14400} ]</span>
</code></pre></div><p>The transition ranges are sorted.</p><h3 id="timestamps"><a href="#timestamps" aria-hidden="true" class="header-anchor">#</a> timestamps</h3><ul><li>returns: <code>Array</code></li><li>cached: yes</li></ul><p>Returns and caches the list of timestamps at which transitions start/end, adding <code>-Float::INFINITY</code> at the beginning and <code>Float::INFINITY</code> at the end.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code>version <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version<span class="token punctuation">.</span>timestamps
<span class="token comment"># =&gt; </span>
<span class="token comment"># [-Infinity,</span>
<span class="token comment">#  -2524504634,</span>
<span class="token comment">#  …</span>
<span class="token comment">#  3104103600,</span>
<span class="token comment">#  Infinity]</span>
</code></pre></div><p>The timestamps are sorted.</p><h3 id="changes"><a href="#changes" aria-hidden="true" class="header-anchor">#</a> changes</h3><ul><li>parameters:
<ul><li><strong>other</strong>: another TZVersion instance.</li></ul></li><li>returns: <code>Array</code></li><li>cached: no</li></ul><p>Calculates the changes between this version an the other version, based on the transition_ranges of each one.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">'a0-tzmigration-ruby'</span>

version_a <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Santiago'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>
version_b <span class="token operator">=</span> <span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'America/Punta_Arenas'</span><span class="token punctuation">,</span> <span class="token string">'2018e'</span><span class="token punctuation">)</span>

version_a<span class="token punctuation">.</span><span class="token function">changes</span><span class="token punctuation">(</span>version_b<span class="token punctuation">)</span>
<span class="token comment"># =&gt;</span>
<span class="token comment"># [{:ini_str=&gt;&quot;-∞&quot;, :fin_str=&gt;&quot;1890-01-01 04:43:40 UTC&quot;, :off_str=&gt;&quot;-00:00:54&quot;, :ini=&gt;-Infinity, :fin=&gt;-2524504580, :off=&gt;-54},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;1946-07-15 04:00:00 UTC&quot;, :fin_str=&gt;&quot;1946-09-01 03:00:00 UTC&quot;, :off_str=&gt;&quot;-01:00:00&quot;, :ini=&gt;-740520000, :fin=&gt;-736376400, :off=&gt;-3600},</span>
<span class="token comment">#  … (ommited) …</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2067-05-15 03:00:00 UTC&quot;, :fin_str=&gt;&quot;2067-08-14 04:00:00 UTC&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;3072654000, :fin=&gt;3080520000, :off=&gt;3600},</span>
<span class="token comment">#  {:ini_str=&gt;&quot;2068-05-13 03:00:00 UTC&quot;, :fin_str=&gt;&quot;∞&quot;, :off_str=&gt;&quot;+01:00:00&quot;, :ini=&gt;3104103600, :fin=&gt;Infinity, :off=&gt;3600}]</span>
</code></pre></div><p>The changes are sorted.</p><h2 id="tzversion-static-methods"><a href="#tzversion-static-methods" aria-hidden="true" class="header-anchor">#</a> TZVersion static methods</h2><h3 id="versions"><a href="#versions" aria-hidden="true" class="header-anchor">#</a> versions</h3><ul><li>returns: <code>Hash</code></li><li>cached: no</li></ul><p>Returns the contents of the <a href="/a0-tzmigration/data/#the-versions-index-json-structure">versions index</a>, as read from the internet.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token function">versions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt;</span>
<span class="token comment"># {&quot;2013c&quot;=&gt;</span>
<span class="token comment">#   {&quot;released_at&quot;=&gt;&quot;2013-04-19 16:17:40 -0700&quot;,</span>
<span class="token comment">#    &quot;timezones&quot;=&gt; [&quot;Africa/Abidjan&quot;, &quot;Africa/Accra&quot;, &quot;Africa/Addis_Ababa&quot;, &quot;Africa/Algiers&quot;, &quot;Africa/Asmara&quot;, …</span>
</code></pre></div><h3 id="timezones"><a href="#timezones" aria-hidden="true" class="header-anchor">#</a> timezones</h3><ul><li>returns: <code>Hash</code></li><li>cached: no</li></ul><p>Returns the contents of the <a href="/a0-tzmigration/data/#the-timezones-index-json-structure">timezones index</a>, as read from the internet.</p><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">A0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZMigration</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TZVersion</span><span class="token punctuation">.</span><span class="token function">timezones</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt;</span>
<span class="token comment"># {&quot;Africa/Abidjan&quot;=&gt;</span>
<span class="token comment">#   {&quot;versions&quot;=&gt;</span>
<span class="token comment">#     [&quot;2013c&quot;, &quot;2013d&quot;, &quot;2013e&quot;, &quot;2013f&quot;, &quot;2013g&quot;, &quot;2013h&quot;, …</span>
</code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/a0/a0-tzmigration/edit/master/docs/api/ruby/README.md" target="_blank" rel="noopener noreferrer">Help us improve this page</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="last-updated"><span class="prefix">updated: </span><span class="time">6/4/2018, 2:37:36 AM</span></div></div><!----></div></div></div>
    <script src="/a0-tzmigration/assets/js/4.8e459df1.js" defer></script><script src="/a0-tzmigration/assets/js/app.af78ef3d.js" defer></script>
  </body>
</html>
